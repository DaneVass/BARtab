/*****************************
 BARtab pipeline configuration
 *****************************/
manifest {
  name = 'DaneVass/BARtab'
  author = 'Dane Vassiliadis'
  homePage = 'www.github.com/DaneVass/BARtab'
  description = 'A Nextflow pipeline to tabulate synthetic barcode counts from NGS data.'
  mainScript = 'BARtab.nf'
  version = '1.0.0'
}

// Default pipeline params
params {
  indir              = null
  outdir             = "./"
  ref                = null
  threads            = 8
  help               = false
  upconstant         = "CGATTGACTA" // SPLINTR 1st gen upstream constant region
  downconstant       = "TGCTAATGCG" // SPLINTR 1st gen downstream constant region
  alnmismatches      = 1
  umi_dist           = 1
  minqual            = 20
  pctqual            = 80
  constants          = "up"
  constantmismatches = 0.1
  min_readlength     = 15
  email              = null
  mode               = "single-bulk"
  cellnumber         = 5000
  bam                = null
  }

executor {
  queueSize = 100
  submitRateLimit = '10 sec'
}

profiles {
  // load profiles
  // standard    { includeConfig 'conf/standard.config'    }
  slurm       { includeConfig 'conf/slurm.config'       }
  conda       { includeConfig 'conf/conda.config'       }
  docker      { includeConfig 'conf/docker.config'      }
  singularity { includeConfig 'conf/singularity.config' }

  // test profiles
  test_SE          { includeConfig 'conf/test_SE.config'          }
  test_PE          { includeConfig 'conf/test_PE.config'          }
  test_SE_ref_free { includeConfig 'conf/test_SE_ref_free.config' }
  test_sc          { includeConfig 'conf/test_sc.config'          }
  test_sc_bam      { includeConfig 'conf/test_sc_bam.config'      }
}

// Capture exit codes from upstream processes when piping
process.shell = ['/bin/bash', '-euo', 'pipefail']

// from nf-core
def trace_timestamp = new java.util.Date().format( 'yyyy-MM-dd_HH-mm-ss')
timeline {
    enabled = true
    file    = "${params.outdir}/pipeline_info/execution_timeline_${trace_timestamp}.html"
}
report {
    enabled = true
    file    = "${params.outdir}/pipeline_info/execution_report_${trace_timestamp}.html"
}
trace {
    enabled = true
    file    = "${params.outdir}/pipeline_info/execution_trace_${trace_timestamp}.txt"
}
dag {
    enabled = true
    file    = "${params.outdir}/pipeline_info/pipeline_dag_${trace_timestamp}.html"
}
